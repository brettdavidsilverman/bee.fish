#ifndef BEE_FISH_PARSER__TEST
#define BEE_FISH_PARSER__TEST

#include <iostream>

#include "query.h"

#include "../test/test.h"


namespace BeeFishQuery {

    using namespace std;
    using namespace BeeFishTest;
    
    bool testBlankspaces();
    bool testCharacters();
    bool testTokens();
    bool testOperators();
    bool testQuery();
    
    inline bool test() 
    {
     
        bool ok = true;
        ok &= testBlankspaces();
        ok &= testCharacters();
        ok &= testTokens();
        ok &= testOperators();
        ok &= testQuery();
        
        if (ok)
            cout << "SUCCESS";
        else
            cout << "FAIL";
            
        BeeFishMisc::outputSuccess(ok);
            
        cout << endl;
        
        return ok;
  
    }
    
    inline bool testBlankspaces()
    {
        cout << "Test Blankspaces" << endl;
        bool ok = true;
            
        ok &= testMatchDelete(
            "Space",
             new Capture(new Query::Blankspaces()),
            " ",
            true,
            " "
        );
        
        ok &= testMatchDelete(
            "Non space",
            new Capture(new Query::Blankspaces(1)),
            "a",
            false
        );
        
        ok &= testMatchDelete(
            "Multiple spaces",
            new Capture(new Query::Blankspaces()),
            " \t ",
            true,
            " \t "
        );


        BeeFishMisc::outputSuccess(ok);

        return ok;
    }
    
    inline bool testCharacters()
    {
        cout << "Test Characters" << endl;
        bool ok = true;
            
        ok &= testMatchDelete(
           "Test a",
            new Capture(new Query::TokenCharacter()),
           "a",
           true,
           "a"
        );
        
        ok &= testMatchDelete(
           "Space",
            new Capture(new Query::TokenCharacter()),
           " ",
           false
        );


        BeeFishMisc::outputSuccess(ok);
        
        return ok;
    }
    
    inline bool testTokens()
    {
        cout << "Test tokens" << endl;
        bool ok = true;
            
        ok &= testMatchDelete(
            "Test token",
             new Capture(new Query::Token()),
            "token",
            true,
            "token"
        );
        
        ok &= testMatchDelete(
            "Test small token 1",
             new Capture(new Query::Token()),
            "b",
            true,
            "b"
        );
        
        ok &= testMatchDelete(
            "Test small token 2",
             new Capture(new Query::Token()),
            "a",
            true,
            "a"
        );
        
        ok &= testMatchDelete(
            "Test token +",
             new Capture(new Query::Token()),
            "+",
            false
        );
        
        ok &= testMatchDelete(
            "Test token and",
             new Capture(new Query::Token()),
            "and",
            false
        );
        
        ok &= testMatchDelete(
            "Test token and{ }",
             new Capture(new Query::Token()),
            "and ",
            false
        );
        

        ok &= testMatchDelete(
            "Test token andother",
             new Capture(new Query::Token()),
            "andother",
            true,
            "andother"
        );
    
        ok &= testMatchDelete(
            "Test token |",
             new Capture(new Query::Token()),
            "|",
            false
        );
        
        ok &= testMatchDelete(
            "Test token or",
             new Capture(new Query::Token()),
            "or",
            false
        );
        
        ok &= testMatchDelete(
            "Test token or{ }",
             new Capture(new Query::Token()),
            "or ",
            false
        );
        
        ok &= testMatchDelete(
            "Test token oranother",
             new Capture(new Query::Token()),
            "oranother",
            true,
            "oranother"
        );
        
        ok &= testMatchDelete(
            "Test token -",
             new Capture(new Query::Token()),
            "-",
            false
        );
        
        ok &= testMatchDelete(
            "Test token not",
             new Capture(new Query::Token()),
            "not",
            false
        );
        
        ok &= testMatchDelete(
            "Test token not{ }",
             new Capture(new Query::Token()),
            "not ",
            false
        );
        
        ok &= testMatchDelete(
            "Test token notother",
             new Capture(new Query::Token()),
            "notother",
            true,
            "notother"
        );

        ok &= testMatchDelete(
            "Blank",
             new Capture(new Query::Token()),
            " ",
            false
        );
        
        ok &= testMatchDelete(
            "Empty",
             new Capture(new Query::Token()),
            "",
            false
        );


        BeeFishMisc::outputSuccess(ok);
assert(ok);

        return ok;
    }
    
    
    
    
    inline bool testOperators()
    {
        cout << "Test operators" << endl;
        bool ok = true;
            
        ok &= testMatchDelete(
           "Operator +",
            new Capture(new Query::And()),
           "+",
           true,
           "+"
        );

        ok &= testMatchDelete(
           "Operator |",
            new Capture(new Query::Or()),
           "|",
           true,
           "|"
        );
        
        
        ok &= testMatchDelete(
           "Operator -",
            new Capture(new Query::Not()),
           "-",
           true,
           "-"
        );
        
        ok &= testMatchDelete(
           "Operator and",
            new Capture(new Query::And()),
           "and",
           true,
           "and"
        );

        ok &= testMatchDelete(
           "Operator or",
            new Capture(new Query::Or()),
           "or",
           true,
           "or"
        );
        
        
        ok &= testMatchDelete(
           "Operator not",
            new Capture(new Query::Not()),
           "not",
           true,
           "not"
        );
        
        BeeFishMisc::outputSuccess(ok);
        
        return ok;
    }
    
    inline bool testQuery()
    {
        cout << "Test queries" << endl;
        bool ok = true;
        BString query;
        
        auto testmatch =
        [&ok](const BString& query) {
            
            if (!ok)
                return false;
            
            ok &= testMatchDelete(
                query,
                new Capture(new Query()),
                query,
                true,
                query
            );
            return ok;
        };
        
        
        testmatch("token1 + token2");
        testmatch("token1+token2");
        testmatch("token1 and token2");
        testmatch("token1 | token2");
        testmatch("token1|token2");
        testmatch("token1 or token2");
        testmatch("not token");
        testmatch("(token)");
        testmatch("( token )");
        testmatch(" ( token ) ");
        testmatch("not (token1)");
        testmatch("not(token1)");
        testmatch("not (token1 or token2)");
        testmatch("(token1 or token2)");
        testmatch("not (token1 or token2)");
        testmatch("(token1 and token2)");
        testmatch("token1 and not token2");
        testmatch("(token1 or token2) and not (token2 or token3)");
        testmatch("token1 and (token2 or token3)");
        testmatch("(token1 and token2) or token3");
        testmatch("(token1 and token2) or (token3 and token4)");
        testmatch("(token1 or token2) and (token3 or token4)");
        testmatch("((token1 or token2))");
        BeeFishMisc::outputSuccess(ok);
        
        return ok;
        
    }
    
}

#endif
